#! /usr/bin/env python
# -*- coding: utf-8 -*-
import requests
import threading
import queue
import json
import time
import os
# import pymysql
import time
import datetime
import re

analyseResult = "./query.ip.result"
infile = '/home/OpenCode/FlowAnay/IDS/toCheck.txt'
infile = '/home/OpenCode/FlowAnay/IDS/clusterIP.txt'
queue = queue.Queue()
re_total = {}
cnt = 0

validePeriod = 30


class query_ip(threading.Thread):
    def __init__(self, queue):
        threading.Thread.__init__(self)
        self.queue = queue

    def ipvoid(self, ip_name):
        url_ipvoid = r"http://www.ipvoid.com/ip-blacklist-check/"
        finsh = False
        while not finsh:
            try:
                payload = {'ip': ip_name}
                r = requests.post(url_ipvoid, data=payload)
                finsh = True
            except Exception as ex:
                print(str(ex))
        if "BLACKLISTED" in str(r.text):
            return "ipvoid:Y"
        else:
            return "ipvoid:N"

    '''
    def bulkblacklist(self,ip_name):
        url_bulk=r'http://www.bulkblacklist.com/'
    '''

    def mxtoolbox(self, ip):
        url = r"https://mxtoolbox.com/Public/Lookup.aspx/DoLookup2"
        payload = json.dumps(
            {"inputText": "blacklist:" + ip, "resultIndex": 1})
        headers = {
            "User-Agent": r"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36",
            "Content-Type": r"application/json; charset=UTF-8",
            "Referer": r"https://mxtoolbox.com/SuperTool.aspx?action=blacklist%3a41.206.73.246&run=toolpage",
            "Accept": r"application/json, text/javascript, */*; q=0.01",
            "Accept-Encoding": r"gzip, deflate, br",
            "Accept-Language": r"zh-CN,zh;q=0.9",
            "Connection": r"keep-alive",
            "Content-Length": r"55",
            "Host": r"mxtoolbox.com",
            "MasterTempAuthorization": r"509f6bbb-2d49-4706-aecb-9da915303bf2",
            "Origin": r"https://mxtoolbox.com",
            "X-Requested-With": r"XMLHttpRequest"
        }
        finsh = False
        while not finsh:
            try:
                r = requests.post(url, data=payload, headers=headers)
                finsh = True
            except Exception as e:
                print(str(e))
        if "We notice you are on a blacklist" in str(r.text):
            return "mxtoolbox:Y"
        else:
            return "mxtoolbox:N"

    def cisco(self, ip):
        url = r"https://talosintelligence.com/sb_api/blacklist_lookup?query_type=ipaddr&query_entry=" + ip
        headers = {
            "user-Agent": r"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36",
            "Accept": r"application/json, text/javascript, */*; q=0.01",
            "Accept-Encoding": r"gzip, deflate, br",
            "Accept-Language": r"zh-CN,zh;q=0.9",
            "referer": r"https://talosintelligence.com/reputation_center/lookup?search=" + ip,
            "cookie": r"__cfduid=df184adec464699be8bfe86c1832ef5e11510555968; _gat=1; _ga=GA1.2.161703073.1510555972; _gid=GA1.2.1788890643.1512549480; _talos_website_session=RFgybWFpUmVVYVZPUW5ZSmxOaFFYaURZU1RaMlBsSFp1YzVCZmh5aDBzRDZmbkVGSXk4SHpFYW8yL0doc3RYRjZTOHdVRGkwcjJlWWtLUi81Y21xajlEVERFTWsrVFpHNE54Z1oyelZlWVZaNEp3WTJ5cFpJcEg1VVFUWDgyellxMFM3NmM3WXlnSWo1SlVlbFRjbU1JcmtrSXNqK1FiZEJHc0xwQXlkS0lZZnB1R3gwWUt2TmVwUE9VdWRQME5sbmZpV3RUdXVxY2V1V004eW1ianQvMVpHVy9vS20zZFU4ODZtR2RqUVhCcU5EZmlBRm5lSVlYKzdUd0RSbFl5c0w5ZU02cDdkSUlGdUlpc0hqeHF0Uk9xUlhjampjVTJKL3FxaXdLa3g0cnhUYUFGbWpnS0VSaXJXSHVmVUY3MjctLUZRaWpiaFFmYlc2eU5XdDhTQ2htUlE9PQ%3D%3D--b77a9ae15fadcf225b5a5fcbbfe262da3de66f7a"
        }
        payload = {"query_type": "ipaddr", "query_entry": ip}
        finsh = False
        while not finsh:
            try:
                r_info = requests.get(url, headers=headers, data=payload)
                finsh = True
            except Exception as ex:
                print(str(ex))
        # print r_info.text
        if "classifications" in r_info.text and r_info.text["classifications"] is not None:
            return r_info.text[r_info.text.index('classifications":["') + 19:r_info.text.index('"]', r_info.text.index(
                'classifications":["') + 19)]
        else:
            return "maySafe"

    def virustotal(self, ip):
        url = "https://www.virustotal.com/en/ip-address/" + ip + "/information/"
        headers = {"accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8",
                   "accept-encoding": "gzip, deflate, br",
                   "accept-language": "zh-CN,zh;q=0.9",
                   "cache-control": "max-age=0",
                   "content-length": "19",
                   "content-type": "application/x-www-form-urlencoded",
                   "cookie": r"VT_PREFERRED_LANGUAGE=en-us; __utma=194538546.174638165.1513582037.1513582037.1513582037.1; __utmc=194538546; __utmz=194538546.1513582037.1.1.utmcsr=cybercrime-tracker.net|utmccn=(referral)|utmcmd=referral|utmcct=/index.php; _ga=GA1.2.174638165.1513582037; _gid=GA1.2.2129582753.1513585172; _gat=1; __utmt=1; __utmb=194538546.43.10.1513582037",
                   "origin": "https://www.virustotal.com",
                   "referer": r"https://www.virustotal.com/en/",
                   "upgrade-insecure-requests": r"1",
                   "user-Agent": r"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36"
                   }
        normalSearch = False
        while not normalSearch:
            response = requests.get(url)
            if (re.match(r'[\s\S]*(id="detected-urls")[\s\S]*"', response.text)):
                normalSearch = True
            else:
                pass
                # logger.debug("search virustotal alnormal." +
                # "\n" + response.text)
        responseContent = response.text
        if self.deteched(responseContent) and self.recent(responseContent):
            return "virustotal:Y"
        else:
            return "virustotal:N"

    def deteched(self, responseContent):
        match_object = re.match(
            '[\s\S]*(id="detected-urls")[\s\S]*?([\d/]+)</span>[\s\S]*', responseContent)
        if match_object:
            if match_object.group(2):
                if 0 == match_object.group(2).split("/")[0]:
                    return False
                else:
                    return True

    def recent(self, responseContent):
        match_object = re.match(
            r'[\s\S]*(id="detected-urls")[\s\S]*?<span>([\d\s:-]+)</span>[\s\S]*', responseContent)
        if match_object:
            if match_object.group(2):
                if match_object.group(2):
                    date = time.strptime(
                        match_object.group(2), "%Y-%m-%d %H:%M:%S")

                    deadTime = datetime.datetime(
                        date[0], date[1], date[2]) + datetime.timedelta(days=validePeriod)
                    return (deadTime - datetime.datetime.now()).days > 0
            else:
                return False

    def run(self):
        while 1:
            try:
                ip = self.queue.get().strip()
                print(ip)
                time.sleep(0.5)
                if ip in re_total:
                    self.queue.task_done()
                    continue

                re_ipvoid = self.ipvoid(ip)
                if str(re_total.get(ip)) == "None":
                    re_total[ip] = [re_ipvoid]
                else:
                    if re_ipvoid not in re_total[ip]:
                        re_total[ip].append(re_ipvoid)

                re_mxtoolbox = self.mxtoolbox(ip)
                if str(re_total.get(ip)) == "None":
                    re_total[ip] = [re_mxtoolbox]
                else:
                    if re_mxtoolbox not in re_total[ip]:
                        re_total[ip].append(re_mxtoolbox)

                # re_cisco = self.cisco(ip)
                # if str(re_total.get(ip)) == "None":
                #     re_total[ip] = [re_cisco]
                # else:
                #     if re_cisco not in re_total[ip]:
                #         re_total[ip].append(re_cisco)

                self.queue.task_done()
            except Exception as e:
                print(e,'error  123123')
                self.queue.task_done()
                return


def work():
    fw = open(analyseResult, "w")
    ip_list = ['45.114.11.169', '103.55.26.178', '116.228.236.202', '222.186.31.20', '103.255.61.159', '23.88.74.82', '118.193.233.48', '182.92.26.10', '121.127.241.67', '211.161.151.132', '101.106.238.55', '123.207.146.214', '47.90.36.140', '103.255.61.131', '45.125.12.249', '101.96.10.63', '103.39.77.166', '58.53.128.26', '103.55.27.27', '211.136.8.18', '103.55.26.176', '58.64.203.124', '111.26.225.139', '222.186.42.59', '103.42.28.206', '45.125.12.73', '211.137.56.198', '123.206.121.116', '103.230.120.20', '220.166.241.224', '202.58.104.31', '103.55.25.195', '112.25.25.98', '103.42.28.220', '203.189.234.89', '101.201.63.243', '117.169.2.83', '101.247.190.38', '101.247.192.38', '111.20.46.154', '111.20.46.191', '111.56.32.230', '112.11.126.202', '118.184.51.172', '103.42.31.108', '103.200.30.163', '103.200.31.76', '103.42.31.41', '103.255.61.67', '45.125.13.206', '118.184.29.205', '103.39.110.81', '43.243.223.180', '103.42.31.31', '203.189.234.24', '103.230.120.197', '103.55.26.118', '45.127.97.153', '103.42.29.151', '103.255.61.229', '103.212.33.200', '120.27.106.184', '118.192.147.100', '120.203.229.9', '222.239.91.23', '103.255.61.162', '222.186.58.124', '103.230.120.177', '103.55.26.25', '103.233.185.135', '211.136.8.26', '203.187.160.133', '23.88.74.85', '103.42.29.146', '101.110.118.71', '112.213.117.167', '116.255.182.157', '125.46.39.219', '23.251.55.193', '103.255.61.169', '69.12.91.46', '103.24.1.120', '123.60.79.254', '111.63.135.59', '103.255.61.234', '210.209.73.163', '210.209.88.104', '103.240.182.118', '154.16.166.202', '103.55.27.173', '103.56.136.123', '203.189.235.158', '45.125.12.87', '23.234.30.20', '111.1.70.208', '112.11.126.201', '103.55.27.190', '111.206.10.66', '124.202.164.4', '45.125.12.239', '103.230.120.167', '103.248.220.24', '103.193.150.181', '103.233.185.115', '213.128.81.82', '103.55.26.47', '117.18.4.107', '218.64.185.144', '222.186.42.49', '103.200.31.180', '27.0.193.183', '103.226.126.5', '203.189.234.191', '45.116.212.230', '111.161.65.82', '45.125.12.59', '103.200.29.1', '121.50.168.11', '103.40.102.125', '123.206.78.117', '103.74.174.20', '211.136.8.29', '203.189.232.237', '45.125.12.108', '103.255.61.161', '117.169.67.19', '116.89.248.42', '27.54.233.74', '118.193.218.147', '103.200.31.108', '203.189.235.157', '117.169.67.25', '210.56.51.80', '205.209.163.226', '203.189.234.52', '45.125.13.215', '103.230.120.58', '122.10.41.29', '45.248.69.89', '202.111.54.53', '103.55.26.123', '103.200.29.25', '117.176.213.70', '123.207.36.69', '58.221.55.77', '103.212.33.248', '222.140.127.14', '121.127.249.45', '103.24.3.25', '205.209.163.202', '103.24.0.34', '69.165.65.72', '223.71.209.70', '27.0.193.174', '216.250.105.157', '103.59.165.90', '45.127.99.184', '58.64.203.116', '103.228.130.102', '103.51.146.95', '103.55.26.18', '122.226.223.169', '45.64.75.132', '103.255.61.74', '120.202.255.137', '124.202.164.9', '124.205.69.131', '27.0.193.13', '116.255.178.52', '198.44.172.86', '103.230.122.243', '101.96.10.65', '103.255.61.140', '124.205.69.162', '123.184.18.150', '121.196.232.36', '123.57.184.42', '43.252.229.94', '111.7.130.136', '203.189.232.12', '43.251.118.89', '111.208.73.30', '103.233.186.156', '45.250.197.247', '103.255.61.165', '121.50.168.46', '198.44.190.3', '103.229.29.81', '211.137.52.157', '211.161.151.134', '103.252.17.169', '27.0.192.209', '222.239.91.215', '103.255.61.112', '103.240.183.20', '103.200.30.182', '103.212.32.34', '139.59.239.127', '205.209.163.211', '103.240.180.125', '103.255.61.86', '98.126.128.247', '111.208.27.232', '182.254.141.219', '103.55.27.132', '111.20.46.157', '111.20.46.91', '45.115.244.243', '115.28.24.226', '119.29.170.12', '111.1.70.210', '112.11.126.200', '103.255.61.182', '59.188.76.48', '27.155.72.124', '198.44.179.54', '220.130.139.135', '114.112.157.27', '103.242.2.160', '120.24.87.20', '47.88.213.137', '211.161.151.131', '111.1.70.205', '101.110.118.21', '101.96.10.62', '69.165.71.26', '115.126.42.98', '103.233.186.239', '103.228.131.184', '107.160.210.229', '103.255.61.116', '103.200.30.19', '123.207.14.254', '202.168.151.28', '45.113.161.159', '115.238.250.120', '103.228.128.216', '45.114.11.96', '118.193.139.143', '122.10.90.224', '221.234.40.67', '115.231.221.121', '115.231.222.136', '121.12.125.91', '122.228.207.29', '125.88.186.74', '183.131.220.65', '183.60.143.11', '220.170.89.132', '221.229.166.107', '222.186.129.92', '222.186.39.64', '222.214.218.40', '222.214.218.86', '58.218.201.70', '58.218.205.76', '103.255.61.160', '116.255.178.249', '113.215.13.67', '111.206.10.68', '219.239.26.11', '112.213.125.220', '45.248.68.146', '118.193.177.61', '103.55.25.193', '103.233.184.94', '211.136.8.19', '111.231.60.239', '45.119.97.151', '45.119.97.155', '155.94.224.185', '218.27.207.217', '118.193.217.240', '183.131.221.59', '183.2.225.229', '183.60.200.70', '221.229.173.139', '222.186.169.123', '222.186.57.232', '222.186.59.162', '198.44.179.102', '112.213.125.189', '202.165.121.243', '45.113.161.134', '114.112.156.227', '103.234.99.13', '103.255.61.10', '178.62.237.135', '178.62.247.88', '103.55.27.60', '43.242.34.6', '111.208.73.60', '122.226.223.162', '101.254.149.217', '101.247.192.10', '119.44.11.179', '14.197.160.100', '166.16.16.254', '203.190.110.156', '211.143.146.219', '211.161.78.52', '211.162.108.19', '211.162.52.227', '211.162.84.39', '116.255.182.165', '180.153.147.40', '180.153.147.43', '180.153.147.46', '211.136.8.17', '103.61.3.99', '180.89.255.51', '107.160.233.82', '185.227.154.60', '111.208.73.45', '103.229.181.140', '103.212.33.185', '183.136.232.137', '220.169.242.94', '118.184.39.159', '221.229.166.55', '222.186.57.70', '120.196.166.113', '103.40.102.231', '182.92.197.116', '210.209.127.52', '219.235.15.61', '103.231.14.14', '111.208.73.46', '111.208.73.20', '111.208.27.233', '118.193.167.104', '123.56.28.77', '211.137.56.179', '121.50.170.192', '103.228.131.159', '121.50.168.109', '124.205.69.164', '219.238.7.67', '103.230.120.27', '116.255.179.225', '103.242.3.230', '112.74.143.202', '43.255.106.139', '118.193.194.169', '117.169.67.27', '118.184.23.40', '103.230.120.186', '101.247.190.47', '123.207.1.117', '103.40.102.25', '180.153.147.85', '111.1.50.59', '111.1.50.18', '111.1.50.69', '111.1.62.39', '211.143.165.98', '43.255.106.47', '45.114.11.90', '61.180.39.72', '118.193.171.133', '45.125.35.173', '101.47.16.34', '111.1.14.198', '111.1.53.99', '112.17.13.223', '103.57.24.106', '103.61.1.121', '45.248.69.149', '111.20.46.193', '125.128.249.50', '111.230.135.163', '107.151.213.89', '45.114.10.204', '120.26.100.114', '111.1.70.212', '219.238.7.73', '103.24.93.252', '222.89.166.14', '124.224.245.12', '182.254.134.205', '116.255.181.77', '43.249.8.240', '122.235.216.17', '103.225.197.70', '223.26.49.147', '117.169.67.11', '103.55.26.74', '103.39.78.121', '117.177.240.136', '111.26.225.148', '117.126.5.134', '39.137.83.132', '39.137.83.226', '104.149.25.136', '45.120.186.179', '172.10.48.7', '112.11.126.204', '103.240.180.150', '45.125.12.223', '45.127.98.110', '118.193.251.209', '103.230.123.220', '103.55.25.139', '103.61.2.157', '103.240.183.88', '139.129.129.142', '123.249.6.125', '43.249.175.177', '118.184.29.224', '183.207.95.7', '183.207.95.9', '45.116.213.170', '103.213.251.163', '39.109.11.100', '103.228.130.83', '103.55.25.26', '103.228.131.123', '114.99.15.179', '182.254.227.210', '203.189.234.130', '123.60.159.65', '120.192.95.134', '111.1.70.209', '103.255.61.18', '103.226.126.27', '103.230.123.141', '103.55.27.224', '111.208.4.228', '111.208.73.39', '111.56.0.147', '111.56.6.5', '113.215.10.221', '113.215.23.29', '120.202.255.149', '45.127.98.34', '61.175.223.227', '103.212.33.249', '116.255.182.154', '27.0.192.93', '45.116.78.100', '115.159.194.203', '27.0.192.76', '103.61.3.96', '198.44.179.15', '103.55.25.87', '120.221.1.6', '50.117.96.37', '114.119.9.252', '103.37.43.205', '153.37.169.146', '59.125.173.162', '103.213.250.133', '111.206.10.71', '114.215.112.147', '117.169.2.50', '180.153.147.44', '111.56.3.146', '111.56.3.148', '50.117.89.249', '139.199.212.70', '121.201.74.113', '119.44.11.165', '119.44.11.173', '60.255.143.150', '120.221.1.33', '211.137.52.156', '120.202.255.132', '113.207.86.116', '183.131.172.22', '101.96.10.61', '111.6.129.137', '111.6.129.136', '183.215.103.174', '183.215.103.176', '198.74.106.177', '124.202.164.7', '103.213.251.191', '183.238.91.54', '123.1.160.188', '103.193.151.204', '45.125.33.19', '112.80.36.143', '180.97.83.169', '202.146.220.132', '118.184.40.235', '116.255.208.60', '117.169.67.24', '211.162.209.171', '103.228.129.162', '219.238.4.226', '219.238.7.72', '104.223.17.75', '124.202.164.8', '103.61.2.31', '121.127.231.14', '58.221.46.62', '103.230.120.189', '111.208.6.232', '180.153.147.45', '117.141.82.185', '183.215.103.179', '103.243.26.151', '23.235.170.92', '211.137.185.106', '58.221.55.24', '122.114.145.7', '116.255.179.214', '69.165.77.116', '180.153.147.76', '180.153.147.84', '139.129.216.179', '103.231.187.139', '43.240.12.213', '211.162.138.40', '23.235.139.105', '219.239.26.13', '122.226.102.162', '182.236.164.22', '203.69.10.241', '117.169.67.26', '113.171.224.246', '120.221.1.27', '103.193.150.33', '137.175.105.110', '111.208.22.237', '111.208.73.11', '111.208.73.43', '111.208.73.44', '103.24.205.134', '203.189.232.242', '203.189.234.150', '211.137.52.159', '121.127.241.118', '103.236.220.41', '103.242.2.61', '112.213.124.68', '103.228.208.187', '45.119.124.207', '104.223.17.98', '117.136.240.193', '119.44.11.175', '121.50.170.186', '116.31.119.161', '45.125.12.76', '113.207.86.121', '43.255.106.249', '45.127.98.197', '119.44.11.169', '103.193.150.100', '111.56.6.9', '101.96.10.64', '103.255.61.60', '120.203.214.5', '217.12.203.173', '112.80.255.202', '45.113.161.194', '203.190.110.146', '49.153.191.6', '120.221.0.59', '45.125.12.145', '211.162.175.12', '103.240.180.223', '45.125.13.153', '58.64.185.127', '27.0.192.5', '180.153.147.70', '116.255.178.211', '103.240.182.221', '120.203.229.41', '118.184.29.211', '111.208.6.164', '111.208.6.167', '111.208.6.168', '111.208.73.40', '103.212.33.206', '39.108.122.241', '103.193.151.244', '121.127.241.185', '123.1.192.176', '111.20.46.153', '103.226.126.15', '27.0.193.103', '103.204.177.9', '117.169.67.3', '218.203.54.57', '111.208.27.230', '211.136.8.20', '180.153.147.78', '59.188.22.181', '120.198.248.228', '111.56.32.229', '111.56.32.232', '202.113.128.16', '118.184.41.58', '122.9.36.32', '198.15.216.77', '116.193.152.227', '103.228.131.80', '203.156.217.51', '118.193.215.113', '219.143.105.5', '103.61.3.187', '120.221.1.19', '124.205.69.137', '121.127.247.107', '103.230.122.182', '103.233.186.232', '45.77.190.168', '211.162.127.14', '113.12.81.51', '113.12.81.43', '111.208.22.236', '124.202.164.6', '118.193.169.132', '124.202.164.5', '111.206.91.11', '111.206.91.7', '124.205.69.167', '211.137.52.155', '202.168.151.209', '103.204.177.156', '103.228.129.238', '180.153.147.37', '211.162.127.23', '124.205.69.169', '219.239.26.4', '203.189.235.139', '123.1.151.75', '103.96.73.175', '103.200.30.193', '140.207.118.114', '124.205.69.132', '219.239.26.14', '103.39.79.80', '211.140.39.211', '103.55.27.179', '103.61.1.8', '116.255.199.222', '113.10.161.186', '27.255.84.233', '101.68.9.77', '111.206.10.67', '175.190.255.38', '67.198.154.229', '117.169.67.5', '122.235.133.52', '111.230.225.234', '27.0.192.92', '45.113.161.179', '112.11.126.199', '58.221.47.184', '103.230.120.187', '211.137.56.175', '103.40.102.221', '103.234.99.105', '211.161.119.134', '220.112.193.200', '124.202.164.13', '45.119.117.5', '120.192.76.26', '45.127.98.15', '117.169.2.44', '183.224.1.44', '121.127.253.142', '103.242.2.19', '211.161.119.136', '103.255.61.246', '103.61.1.27', '118.206.148.90', '103.255.61.73', '121.42.160.157', '103.255.61.124', '89.34.111.231', '103.61.2.29', '117.169.67.20', '118.184.29.218', '220.249.103.162', '103.240.182.29', '221.176.1.140', '103.255.61.244', '43.225.58.217', '117.169.67.9', '118.193.155.83', '103.231.164.107', '180.153.147.15', '103.228.130.46', '210.31.225.146', '103.233.186.127', '2.2.2.1', '103.240.180.112', '103.240.180.155', '118.184.29.202', '103.61.1.36', '122.10.95.212', '103.255.61.224', '98.126.134.138', '221.10.255.233', '103.255.61.189', '104.149.25.177', '111.161.65.95', '210.56.50.105', '221.181.24.8', '203.189.235.239', '103.255.61.204', '121.126.211.32', '103.255.61.103', '211.147.114.95', '124.202.164.16', '117.169.67.4', '162.211.181.175', '103.236.220.33', '205.209.183.97', '120.203.229.3', '103.193.150.113', '202.181.24.68', '116.199.2.209', '211.143.165.97', '103.37.124.131', '118.184.29.204', '203.189.234.77', '69.172.210.142', '103.200.118.247', '103.37.43.208', '111.12.251.178', '111.12.251.176', '43.248.11.195', '122.10.41.237', '43.243.220.171', '103.200.31.21', '103.213.251.241', '23.224.108.65', '103.252.17.186', '103.255.61.147', '103.24.205.189', '27.0.193.107', '103.241.51.160', '27.0.193.148', '103.56.113.236', '114.99.22.105', '118.193.202.7', '202.168.151.226', '101.96.10.27', '101.96.10.30', '45.127.97.112', '103.255.61.188', '174.139.204.215', '115.159.109.91', '103.233.185.110', '118.123.18.95', '139.199.10.40', '36.110.79.139', '45.125.12.118', '117.75.20.6', '211.162.52.230', '222.140.125.251', '45.116.77.64', '43.243.220.94', '67.198.154.246', '112.213.117.65', '114.99.10.207', '124.234.116.29', '219.238.4.196', '116.77.75.196', '103.230.122.244', '103.233.186.148', '45.125.12.190', '103.240.180.163', '103.240.182.126', '103.230.122.154', '121.50.171.252', '103.212.32.228', '111.20.46.190', '211.162.108.23', '211.162.62.154', '111.20.46.187', '111.208.6.162', '111.56.32.237', '118.206.148.29', '211.161.151.137', '211.162.138.41', '211.162.82.70', '107.150.52.116', '103.212.33.205', '116.255.182.178', '103.231.164.19', '27.0.193.184', '45.119.117.7', '112.213.117.83', '118.193.147.226', '115.29.136.128', '219.238.4.227', '103.231.164.95', '45.113.162.228', '123.60.104.95', '103.255.61.166', '120.221.1.32', '113.10.243.142', '103.204.179.168', '111.20.46.185', '43.248.11.152', '103.55.25.46', '45.125.12.232', '111.1.50.73', '111.1.50.199', '111.1.14.194', '111.1.50.170', '111.1.50.62', '199.188.104.234', '117.59.81.78', '120.203.214.21', '121.127.252.185', '103.200.31.65', '117.169.20.114', '103.255.61.243', '211.162.108.22', '23.251.33.70', '45.116.212.23', '96.44.183.42', '111.1.62.36', '111.1.50.106', '103.236.220.243', '119.44.11.163', '103.226.124.60', '103.39.19.249', '160.20.59.136', '69.165.64.179', '120.203.229.42', '120.203.214.14', '103.240.156.168', '123.1.190.148', '45.114.11.16', '123.1.151.52', '45.127.97.10', '120.203.214.22', '103.240.182.11', '118.193.131.165', '27.0.192.194', '45.113.163.222', '103.200.116.96', '45.113.161.131', '103.255.61.101', '103.204.179.218', '103.39.77.7', '118.193.206.148', '103.61.2.82', '103.24.93.156', '172.246.236.186', '121.50.171.230', '121.50.168.61', '101.247.192.69', '111.161.65.78', '69.165.77.92', '211.162.52.233', '219.238.7.66', '1.171.54.128', '119.44.11.167', '119.44.11.160', '23.234.63.52', '69.165.64.146', '103.239.74.93', '123.60.165.122', '117.169.67.22', '103.42.29.131', '101.96.10.59', '175.190.255.167', '58.64.179.58', '58.64.179.59', '111.6.128.80', '43.249.11.75', '103.248.220.124', '103.214.170.19', '182.92.99.102', '103.240.182.49', '211.147.226.170', '120.203.214.4', '111.1.50.52', '111.1.50.109', '111.1.50.14', '111.1.50.195', '111.1.50.21', '111.1.50.37', '111.1.50.38', '111.1.50.55', '111.1.50.57', '111.1.50.68', '111.1.50.70', '111.1.50.82', '111.1.51.21', '111.1.51.23', '111.1.51.27', '111.1.62.11', '111.1.62.12', '111.1.62.19', '111.1.62.23', '111.1.62.37', '111.1.62.38', '111.1.62.43', '112.17.13.242', '43.255.106.60', '103.61.1.84', '45.33.107.180', '103.230.120.180', '211.162.52.228', '43.248.98.232', '121.201.45.248', '117.169.2.82', '118.193.167.55', '103.233.185.140', '101.247.192.12', '121.22.248.3', '123.57.133.249', '42.51.196.43', '125.227.174.32', '69.165.77.114', '203.189.232.165', '114.45.17.15', '124.202.164.11', '49.221.26.11', '116.255.208.42', '119.44.11.170', '103.14.113.220', '103.228.129.172', '43.241.196.208', '198.44.179.24', '14.197.160.101', '120.199.224.83', '211.161.151.133', '211.161.119.139', '162.211.181.72', '118.193.235.121', '103.240.183.186', '123.60.131.203', '172.11.0.29', '45.116.212.209', '43.250.74.6', '103.85.225.206', '117.156.241.155', '211.161.119.53', '43.255.106.133', '180.153.147.18', '180.153.147.19', '118.193.218.16', '111.1.62.24', '111.1.62.27', '111.1.50.200', '103.213.251.172', '111.1.50.43', '111.1.50.16', '111.1.51.25', '103.61.1.173', '103.230.120.215', '111.1.50.105', '111.1.50.190', '111.1.50.40', '111.1.50.45', '111.1.50.65', '45.35.110.7', '174.139.204.235', '117.158.146.76', '121.127.252.90', '103.230.120.3', '116.212.115.77', '23.239.105.16', '120.221.1.29', '121.201.58.227', '103.204.177.150', '103.24.0.166', '103.233.186.14', '203.195.168.32', '203.189.234.17', '43.251.17.92', '118.193.162.88', '210.209.85.173', '116.255.242.94', '121.22.36.101', '45.125.12.17', '112.11.126.203', '124.205.69.170', '101.247.192.36', '118.193.226.40', '124.205.69.134', '123.206.78.194', '103.229.125.73', '103.78.126.13', '211.162.138.35', '175.190.126.179', '211.162.84.40', '103.206.22.225', '223.210.51.65', '45.125.12.136', '45.127.97.108', '211.104.160.31', '211.162.127.22', '103.61.3.14', '27.0.192.6', '69.165.73.101', '202.146.220.120', '122.10.89.174', '111.1.50.23', '101.47.16.33', '219.238.4.195', '182.255.60.87', '202.168.151.39', '118.193.179.82', '120.192.76.117', '103.61.1.165', '175.190.255.34', '111.1.50.53', '111.1.50.19', '111.1.50.196', '103.240.157.127', '117.169.67.7', '120.26.130.84', '121.127.241.182', '43.249.11.49', '118.193.153.62', '118.193.172.25', '58.53.128.218', '122.114.156.245', '222.140.127.99', '43.255.106.244', '211.161.29.36', '45.114.11.121', '59.49.109.22', '103.55.26.9', '111.206.91.3', '103.242.2.180', '116.196.78.231', '103.212.32.191', '203.189.234.167', '103.24.93.133', '45.125.12.245', '103.204.177.131', '122.128.109.94', '118.184.18.227', '111.1.70.204', '175.190.255.148', '221.181.24.9', '111.1.50.48', '103.255.61.44', '203.189.232.21', '175.190.255.166', '174.139.204.214', '101.110.118.20', '180.153.147.63', '180.153.147.65', '218.76.105.22', '43.243.221.121', '119.97.196.149', '103.200.30.127', '111.206.91.4', '118.193.173.134', '122.10.92.165', '162.247.96.214', '162.247.99.254', '23.247.25.227', '103.231.15.32', '42.51.41.69', '103.200.30.215', '103.193.151.251', '117.190.191.158', '175.190.126.178', '211.136.8.28', '211.162.127.20', '218.203.54.42', '221.181.104.30', '45.114.11.104', '23.235.170.224', '111.208.6.163', '111.208.6.182', '203.190.110.152', '103.242.2.20', '123.1.160.204', '45.127.97.199', '103.61.1.20', '111.6.128.71', '101.110.118.22', '103.213.251.215', '103.230.123.213', '218.6.173.38', '180.153.147.17', '180.153.147.66', '180.153.147.67', '180.153.147.69', '118.193.228.21', '120.192.95.71', '103.212.33.246', '133.130.118.216', '118.193.162.76', '43.248.9.233', '103.17.118.209', '111.1.70.206', '111.20.46.194', '103.85.20.16', '120.221.1.10', '203.207.105.20', '103.233.187.238', '103.85.20.28', '219.238.7.68', '123.60.106.151', '123.60.106.143', '124.202.164.12', '101.105.255.42', '216.250.105.188', '103.242.3.242', '103.225.197.69', '118.184.29.207', '111.1.50.61', '118.206.148.89', '120.221.0.64', '103.55.27.23', '125.62.23.98', '45.125.13.130', '175.190.126.191', '111.20.46.151', '103.230.123.26', '107.150.52.114', '211.162.127.3', '123.1.160.186', '120.192.95.166', '43.255.106.19', '43.243.220.154', '211.161.119.138', '118.99.57.93', '180.153.147.64', '104.223.17.89', '45.125.35.28', '103.24.3.206', '174.139.203.86', '180.153.147.77', '180.153.147.79', '120.198.244.60', '122.10.112.246', '139.199.207.50', '120.221.1.30', '120.203.229.36', '113.215.18.70', '211.136.10.56', '45.114.11.93', '203.189.234.151', '174.139.239.214', '45.113.161.122', '50.117.89.38', '103.42.31.39', '103.40.102.113', '45.113.161.125', '103.255.61.238', '103.226.126.1', '27.255.92.160', '114.215.83.239', '117.59.81.67', '125.94.49.29', '103.61.0.108', '122.10.116.32', '162.251.21.59', '103.51.146.128', '123.1.191.197', '111.208.73.23', '121.127.234.57', '103.240.157.210', '117.27.241.21', '222.163.202.184', '116.255.138.70', '203.189.232.199', '103.55.25.127', '118.193.234.185', '112.213.124.142', '107.151.214.231', '45.122.52.47', '103.230.123.167', '183.207.95.12']
    # for line in open(infile).readlines():
    #     ip_list.append(line.strip())
    t = query_ip(queue)
    t.setDaemon(True)
    t.start()
    for ip in ip_list:
        queue.put(ip)
    queue.join()
    time.sleep(1)

    for (k, v) in re_total.items():
        print(k, v)
        fw.write(str(k) + "\t" + str(v) + "\n")
    fw.close()


work()
